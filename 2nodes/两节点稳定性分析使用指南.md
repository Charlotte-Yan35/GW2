# 两节点电网稳定性分析 - 使用指南

## 1. 系统模型

### 原始方程（两个耦合振子）
$$\frac{d^2\theta_1}{dt^2} + \gamma\frac{d\theta_1}{dt} = P - \kappa\sin(\theta_1 - \theta_2)$$
$$\frac{d^2\theta_2}{dt^2} + \gamma\frac{d\theta_2}{dt} = -P - \kappa\sin(\theta_2 - \theta_1)$$

### 化简后的系统（令 Δθ = θ₁ - θ₂）
$$\frac{d(\Delta\theta)}{dt} = \omega$$
$$\frac{d\omega}{dt} = 2P - \gamma\omega - 2\kappa\sin(\Delta\theta)$$

---

## 2. 参数选择指南

### 2.1 耦合强度 κ

| 场景 | κ 值 | 说明 |
|------|------|------|
| 归一化分析 | κ = 1 | 便于理论分析，论文中常用 |
| 实际物理值 | κ ≈ 18.3 kW | 基于 V₀²B，其中 V₀=240V, B=1/X_L |
| 弱耦合测试 | κ = 0.5 | 研究低耦合下的行为 |
| 强耦合测试 | κ = 2.0 | 研究高耦合下的稳定性 |

**物理意义**: κ 代表传输线路能承载的最大功率

### 2.2 阻尼系数 γ

| 场景 | γ 值 | 说明 |
|------|------|------|
| 标准值 | γ = 1 | 论文中常用的基准值 |
| 欠阻尼 | γ < 1 | 系统会振荡后收敛（螺旋点） |
| 过阻尼 | γ > 2 | 系统单调收敛（节点） |
| 临界阻尼 | γ = 2√(κ²-P²)/κ | 恰好不振荡 |

**稳定螺旋条件**: 0 < γ² < 8√(κ²-P²)

### 2.3 功率 P

| 场景 | P/κ 比值 | 说明 |
|------|----------|------|
| 安全运行 | P/κ < 0.7 | 有足够的稳定裕度 |
| 接近临界 | 0.9 < P/κ < 1 | 系统脆弱，易受扰动影响 |
| 临界点 | P/κ = 1 | 鞍结点分岔，稳定点消失 |
| 超临界 | P/κ > 1 | **系统失稳！无稳定解** |

**推荐测试值**:
```python
# 稳定情况
P = 0.5, kappa = 1.0  # P/κ = 0.5

# 接近临界
P = 0.9, kappa = 1.0  # P/κ = 0.9

# 超临界（测试失稳）
P = 1.2, kappa = 1.0  # P/κ = 1.2
```

---

## 3. 随机事件的插入方法

### 3.1 事件类型

代码中提供了多种插入随机事件的方式：

#### 方式1: 离散事件（推荐）
```python
# 在特定时刻施加扰动
event_times = [20, 40, 60]  # 事件发生时刻
event_magnitudes = [
    (0.2, 0.0),   # t=20: Δθ增加0.2
    (-0.1, 0.5),  # t=40: Δθ减少0.1, ω增加0.5
    (0.0, -0.3),  # t=60: ω减少0.3
]

simulate_with_random_events(
    P=0.5, kappa=1.0, gamma=1.0,
    event_times=event_times,
    event_magnitudes=event_magnitudes
)
```

#### 方式2: 功率阶跃变化（模拟负载突变）
```python
# 模拟t=30时刻负载突然增加
simulate_cascading_failure(
    P_initial=0.5,      # 初始功率
    P_after_failure=0.95,  # 故障后功率
    failure_time=30,    # 故障时刻
    kappa=1.0, gamma=1.0
)
```

#### 方式3: 随机生成事件
```python
# 让程序自动随机生成事件
simulate_with_random_events(
    P=0.5, kappa=1.0, gamma=1.0,
    event_times=None,  # None表示随机生成
    event_magnitudes=None
)
```

### 3.2 事件的物理意义

| 扰动类型 | 对应物理现象 | 代码实现 |
|----------|------------|----------|
| Δθ 突变 | 相位跳变（线路切换） | `(delta_theta, 0)` |
| ω 突变 | 频率扰动（负载突变） | `(0, delta_omega)` |
| P 阶跃 | 发电机跳闸/负载增加 | `simulate_cascading_failure()` |
| κ 变化 | 线路故障/容量降低 | 需修改代码 |

### 3.3 添加连续噪声（高级）

如果需要添加连续的随机噪声，可以使用随机微分方程：

```python
import numpy as np

def add_continuous_noise(t, y, P, kappa, gamma, noise_strength=0.1):
    """添加连续白噪声"""
    delta_theta, omega = y

    # 确定性部分
    d_delta_theta = omega
    d_omega = 2*P - gamma*omega - 2*kappa*np.sin(delta_theta)

    # 随机部分（每个时间步添加）
    noise_theta = noise_strength * np.random.randn()
    noise_omega = noise_strength * np.random.randn()

    return [d_delta_theta + noise_theta, d_omega + noise_omega]
```

---

## 4. 测试建议

### 4.1 基本测试流程

```python
# Step 1: 验证稳定性分析
results = analyze_stability(P=0.5, kappa=1.0, gamma=1.0)

# Step 2: 绘制分岔图（验证P/κ=1处的分岔）
plot_bifurcation_diagram()

# Step 3: 绘制相图（观察稳定点和鞍点）
plot_phase_portrait(P=0.5, kappa=1.0, gamma=1.0)

# Step 4: 时间序列（验证收敛行为）
plot_time_series(P=0.5, kappa=1.0, gamma=1.0)
```

### 4.2 敏感性测试

```python
# 测试不同P值
for P in [0.3, 0.5, 0.7, 0.9, 0.95]:
    print(f"P/κ = {P}")
    results = analyze_stability(P, kappa=1.0, gamma=1.0)

# 测试不同γ值
for gamma in [0.1, 0.5, 1.0, 2.0]:
    print(f"γ = {gamma}")
    plot_phase_portrait(P=0.5, kappa=1.0, gamma=gamma)
```

### 4.3 临界行为测试

```python
# 观察接近分岔点的行为
for P in [0.90, 0.95, 0.99, 1.01]:
    try:
        fp1, fp2 = find_fixed_points(P, kappa=1.0)
        if fp1:
            print(f"P={P}: 稳定点在 Δθ*={fp1[0]:.4f}")
        else:
            print(f"P={P}: 无稳定点!")
    except:
        print(f"P={P}: 计算失败")
```

---

## 5. 预期结果

### 5.1 分岔图 (Fig S1A)

- 蓝色曲线（下支）：稳定不动点 Δθ* = arcsin(P/κ)
- 青色曲线（上支）：鞍点 Δθ* = π - arcsin(P/κ)
- 黑点：P/κ = 1 处的鞍结点分岔

### 5.2 相图 (Fig S1B)

- 绿点：稳定螺旋（或稳定节点）
- 红点：鞍点
- 流线：系统轨迹，应该螺旋收敛到稳定点

### 5.3 稳定性判据

| 条件 | 第一不动点 | 第二不动点 |
|------|-----------|-----------|
| det(J) | > 0 (稳定) | < 0 (鞍点) |
| trace(J) | -γ < 0 | -γ < 0 |
| 特征值 | 负实部 | 一正一负 |

---

## 6. 常见问题

### Q1: 为什么我的系统不收敛？
**A**: 检查 P/κ 是否 > 1。如果超过临界值，系统没有稳定解。

### Q2: 如何选择合适的初始条件？
**A**:
- 测试稳定性：从稳定点附近开始，如 `y0 = [arcsin(P/κ) + 0.1, 0]`
- 测试吸引域：从不同位置开始，观察是否都收敛到同一点

### Q3: 如何验证代码正确性？
**A**:
1. 检查 P=0 时，Δθ*=0 是否是稳定点
2. 检查 P/κ=1 时，两个不动点是否合并
3. 对比论文中的 Fig S1

---

## 7. 运行代码

```bash
# 在终端运行
cd /path/to/outputs
python two_node_stability_analysis.py
```

或在 Jupyter Notebook 中：
```python
%run two_node_stability_analysis.py
```

---

*本文档配合 `two_node_stability_analysis.py` 使用*
